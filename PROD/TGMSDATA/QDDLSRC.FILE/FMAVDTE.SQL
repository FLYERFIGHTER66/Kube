--    Availability Date File
--    Converted to DDL on 01/05/2018 - WJB

CREATE OR REPLACE TABLE FMAVDTE (
        AVITEM CHAR(12) CCSID 37 NOT NULL DEFAULT '' ,
	AVSIZE CHAR(3)  CCSID 37 NOT NULL DEFAULT '' ,
	AVDMDY NUMERIC(8, 0) NOT NULL DEFAULT 0 ,
	AVDYMD NUMERIC(8, 0) NOT NULL DEFAULT 0 ,
	AVCOMM CHAR(30) CCSID 37 NOT NULL DEFAULT '' ,
	AVREAS CHAR(30) CCSID 37 NOT NULL DEFAULT '' ,
	AVSUBITEM CHAR(12) CCSID 37 NOT NULL DEFAULT '' ,
	AVSUBSIZE CHAR(3) CCSID 37 NOT NULL DEFAULT '' ,

	created_ts FOR COLUMN
		ENCCRTIME TIMESTAMP NOT NULL WITH DEFAULT CURRENT TIMESTAMP ,
	created_by FOR COLUMN ENCCRUSER
		CHAR(18) NOT NULL WITH DEFAULT USER ,
	updated_ts FOR COLUMN ENCUDTIME TIMESTAMP NOT NULL FOR
		EACH ROW ON UPDATE AS ROW change TIMESTAMP ,
	updated_by FOR COLUMN ENCUDUSER CHAR(18) NOT
		NULL WITH DEFAULT USER,

	PRIMARY KEY( AVITEM , AVSIZE ) )

	RCDFMT RMAVDTE    ;

LABEL ON TABLE FMAVDTE
	IS 'Availability Date File' ;

LABEL ON COLUMN FMAVDTE
( AVITEM IS 'Item Number' ,
	AVSIZE IS 'Size' ,
	AVDMDY IS 'Avail Date' ,
	AVDYMD IS 'Avail Date' ,
	AVCOMM IS 'Comment' ,
	AVREAS IS 'Reason' ,
	AVSUBITEM IS 'Substitute          Item Number' ,
	AVSUBSIZE IS 'Substitute          Size'
) ;


LABEL ON COLUMN FMAVDTE
( AVITEM TEXT IS 'ITEM #' ,
	AVSIZE TEXT IS 'SIZE CODE' ,
	AVDMDY TEXT IS 'AVAIL DATE MDY' ,
	AVDYMD TEXT IS 'AVAIL DATE YMD' ,
	AVCOMM TEXT IS 'COMMENT' ,
	AVREAS TEXT IS 'REASON' ,
	AVSUBITEM TEXT IS 'SUB ITEM #' ,
	AVSUBSIZE TEXT IS 'SUB SIZE CODE' ) ;

GRANT DELETE , INSERT , SELECT , UPDATE
ON FMAVDTE TO PUBLIC ;

GRANT ALTER , DELETE , INDEX , INSERT , REFERENCES , SELECT , UPDATE
ON FMAVDTE TO QDFTOWN WITH GRANT OPTION ;

-- Create a trigger to update the Last Update User ID
CREATE OR REPLACE TRIGGER FMAVDTE_TR01
    BEFORE UPDATE ON FMAVDTE
    REFERENCING NEW ROW AS NEWROW OLD ROW AS OLDROW
    FOR EACH ROW MODE DB2ROW
    SET NEWROW.updated_by = USER;

;
